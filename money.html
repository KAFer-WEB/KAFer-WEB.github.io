<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>KAFer - KAFerマネー管理</title>

    <!-- Asset paths updated for the new file structure -->
    <link id="favicon" rel="icon" href="/assets/icons/icon.png" type="image/png">
    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/assets/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Manifest path should be absolute from the root directory -->
    <link rel="manifest" href="/manifest.webmanifest">
</head>
<body class="app-container admin-page">
    <header class="app-header">
        <div class="logo"><h1>KAFer Admin</h1></div>
        <div class="user-controls">
            <span class="user-info-header" id="header-user-info"></span>
            <button class="logout-btn" onclick="logoutUser()"><i class="fas fa-sign-out-alt"></i> ログアウト</button>
        </div>
    </header>
    
    <div class="main-content-wrapper">
        <!-- Sidebar Navigation for Desktop -->
        <aside class="sidebar">
            <nav id="admin-sidebar-nav">
                <!-- Sidebar content is generated by initializeAdminUI() in global.js -->
            </nav>
        </aside>
        
        <main class="container">
            <div id="message-area" class="message"></div>

            <div id="code-management-section" class="content-section">
                <h2><i class="fas fa-money-check-alt"></i> KAFerマネー管理</h2>
                
                <!-- Tab Navigation -->
                <div class="tab-navigation" id="code-management-tab-nav">
                    <button class="tab-button active" data-target="issued-codes-tab"><i class="fas fa-clipboard-list"></i> 発行済みコード</button>
                    <button class="tab-button" data-target="issue-code-tab"><i class="fas fa-hand-holding-usd"></i> コード発行</button>
                    <button class="tab-button" data-target="void-code-tab"><i class="fas fa-ban"></i> コード無効化</button>
                    <button class="tab-button" data-target="refund-approval-tab"><i class="fas fa-cash-register"></i> 返金承認</button>
                </div>
                
                <div class="tab-content-wrapper" id="code-management-tab-content">
                    <!-- Issued Codes Tab -->
                    <div id="issued-codes-tab" class="tab-content" style="display: block;">
                        <h3>発行済みKAFerマネーコードリスト</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr><th>コード</th><th>金額 (KAFer)</th><th>金額 (円)</th><th>発行日</th><th>ステータス</th><th>利用者</th></tr>
                                </thead>
                                <tbody id="issued-codes-list"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Issue Code Tab -->
                    <div id="issue-code-tab" class="tab-content">
                        <h3>KAFerマネーコード発行</h3>
                        <form id="issue-code-form">
                            <div class="form-group">
                                <label for="new-money-code"><i class="fas fa-qrcode"></i> 新しいKAFerマネーコード (16桁の数字)</label>
                                <div class="input-with-button">
                                    <input type="text" id="new-money-code" required pattern="[0-9]{16}" title="16桁の数字を入力してください">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('new-money-code').value = generateRandomMoneyCode();">
                                        <i class="fas fa-random"></i> 生成
                                    </button>
                                </div>
                            </div>
                            <div class="form-group"><label for="code-amount-yen"><i class="fas fa-yen-sign"></i> 金額 (円, 10円単位)</label><input type="number" id="code-amount-yen" required min="10" step="10" value="100" title="10円以上の10円単位で入力してください"></div>
                            <div class="form-group" id="qrcode-container" style="display: none;"><canvas id="qrcode-canvas"></canvas><p>KAFerマネーコード: <span id="qrcode-text"></span></p></div>
                            <button type="submit" class="btn"><i class="fas fa-plus-square"></i> コード発行</button>
                        </form>
                    </div>
                    
                    <!-- Void Code Tab -->
                    <div id="void-code-tab" class="tab-content">
                        <h3>KAFerマネーコード無効化</h3>
                        <form id="void-code-form">
                            <div class="form-group"><label for="void-money-code"><i class="fas fa-barcode"></i> 無効化するKAFerマネーコード (16桁の数字)</label><input type="text" id="void-money-code" required pattern="[0-9]{16}" title="16桁の数字を入力してください"></div>
                            <button type="submit" class="btn btn-danger"><i class="fas fa-ban"></i> コードを無効化</button>
                        </form>
                    </div>
                    
                    <!-- Refund Approval Tab -->
                    <div id="refund-approval-tab" class="tab-content">
                        <h3>返金申請承認</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr><th>申請日</th><th>KAFer ID</th><th>ユーザー名</th><th>申請額</th><th>返金額</th><th>返還コード</th><th>アクション</th></tr>
                                </thead>
                                <tbody id="refund-requests-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- External library for QR code generation -->
    <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.js"></script>

    <!-- App scripts -->
    <script src="/assets/js/global.js"></script>
    <script src="/assets/js/admin/money.js"></script>
</body>
</html>